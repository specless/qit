<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Flex Impact Preview</title>
  <link rel="stylesheet" href="../../qit.css">
  <style>
  .ui-resizable-e {
    position: absolute;
    top: 50%;
    right: -30px;
    padding: 14px 3px 10px 3px;
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
    z-index: 0 !important;
    opacity:0.60;
  }

  .ui-resizable-e::before, .ui-resizable-w::before {
    transform: rotate(90deg);
  }

  .ui-resizable-w {
    position: absolute;
    top: 50%;
    left: -30px;
    padding: 14px 3px 10px 3px;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    z-index: 0 !important;
    opacity:0.60;
  }

  .iframe-overlay {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    display: none;
    z-index: 2;
  }

  .ui-resizable-resizing .iframe-overlay {
    display: block;
  }

  #browser {
    left: 0 !important;
    right: 0 !important;
    position: absolute;
    bottom: 0;
    height:calc(100% - 40px);
    min-width: 720px;
    max-width: calc(100% - 65px);
    width: auto;
    margin-left: auto;
    margin-right: auto;
  }

  #browser.mobile-view {
    max-width: 520px !important;
    min-width: 320px !important;
  }

  #iframe {
    position: relative;
    z-index:1;
    background-color: white;
  }

  .sp-app-scroll-area {
    overflow-y: hidden !important;
  }
  </style>
</head>

<body class="sp-app sp-technical">
  <div class="sp-app-bar sp-container-light sp-contrast sp-wrapper">
    <div class="sp-row sp-fluid sp-vcenter sp-height-3">
      <div class="sp-col sp-span-6 sp-flex" style="align-items: center;">
        <img src="https://www.dotdash.com/assets/img/dash/dash-logo-tiny@2x.png" width="60" class="sp-margin-right-1"/>
        <div class="sp-spacer-horizontal sp-margin-right-2"></div>
        <p class="sp-margin-left-1 sp-inline sp-margin-0 sp-contrast sp-large">Flex Impact Preview</p>
      </div>
      <div class="sp-col sp-span-6 sp-align-right sp-small">
        <img class="sp-width-4 sp-float-right" src="../../assets/img/powered-by.png"/>
      </div>
    </div>
  </div>
  <div class="sp-app-menu sp-container-light sp-contrast sp-border-top-base sp-wrapper">
    <div class="sp-row sp-fluid sp-height-2 sp-vcenter sp-padding-horizontal-3 sp-small" style="min-width: 1400px">
      <div class="sp-selector sp-margin-left-1">
        <input id="previewUrl" class="sp-padding-icon-left sp-padding-label sp-selector-trigger sp-align-right sp-width-9" type="url" value="https://www.thebalance.com/setting-investment-goals-for-financial-independence-4120968" style="text-align: left; padding-left: 130px"/>
        <div class="sp-selector-overlay sp-icon-link">
          <div class="sp-selector-label" style="height: 100%;line-height: 2.2;">Preview Page</div>
          <div class="sp-menu-dropdown sp-overlay">
            <a class="sp-menu-item sp-state-active url-button" data-url="https://www.thebalance.com/setting-investment-goals-for-financial-independence-4120968">The Balance</a>
            <a class="sp-menu-item url-button" data-url="https://www.verywell.com/can-stem-cells-treat-arthritis-and-cartilage-damage-4126778">Very Well</a>
            <a class="sp-menu-item url-button" data-url="https://www.thespruce.com/dont-do-things-first-apartment-4071917">The Spruce</a>
            <a class="sp-menu-item url-button" data-url="https://www.lifewire.com/using-venmo-4134462">Lifewire</a>
            <!-- <a class="sp-menu-item url-button" data-url="">Trip Saavy</a> -->
            <a class="sp-menu-item url-button" data-url="https://www.thoughtco.com/excelsior-program-4137813">Thought Co.</a>
          </div>
        </div>
      </div>
      <div class="sp-selector sp-margin-left-1">
        <input id="creativeId" class="sp-padding-icon-left sp-padding-label sp-selector-trigger sp-align-right sp-width-7" type="url" value="jRf8TK" style="text-align: left; padding-left: 130px"/>
        <div class="sp-selector-overlay sp-icon-creative">
          <div class="sp-selector-label" style="height: 100%;line-height: 2.2;">Creative ID</div>
          <div class="sp-menu-dropdown sp-overlay">
            <a class="sp-menu-item sp-state-active creative-button" data-creative="jRf8TK">Liquid Plumber</a>
            <a class="sp-menu-item creative-button" data-creative="gv92vb">Specless Demo Creative</a>
          </div>
        </div>
      </div>
      <div class="sp-spacer-horizontal sp-margin-right-1"></div>
      <button class="sp-margin-right-1 aspect-button sp-state-active" data-test="524821134TEST" data-aspect="3by1">3:1</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821134TEST" data-aspect="4by1">4:1</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821134TEST" data-aspect="8by1">8:1</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821374TEST" data-aspect="1by1">1:1</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821374TEST" data-aspect="1by2">1:2</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821374TEST" data-aspect="1by3">1:3</button>
      <button class="sp-margin-right-1 aspect-button" data-test="524821254TEST" data-aspect="2by1">2:1</button>
      <div class="sp-spacer-horizontal sp-margin-right-1"></div>
      <span></span>
      <button id="reload" class="sp-icon-reload"></button>
      <button id="newWindow" class="sp-icon-external sp-margin-left-1"></button>
    </div>
  </div>
  <div class="sp-container-light sp-app-content sp-wrapper">
    <div class="sp-app-scroll-area sp-align-center">
      <div id="browser" class="sp-overlay sp-inline" style="">
        <iframe id="iframe" src="" style="width: 100%;border: 0; height: 100%; width: 100%"></iframe>
        <div class="iframe-overlay"></div>
      </div>
    </div>
  </div>
  <!-- <div class="sp-app-footer sp-container-light sp-contrast sp-border-top-base">
    <div class="sp-row sp-fluid sp-height-1">
      
    </div>
  </div> -->
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
<script>
$( function() {
  $( "#browser" ).resizable({
    handles: "e, w",
    classes: {
      "ui-resizable-e": "sp-icon-dropdown sp-overlay",
      "ui-resizable-w": "sp-icon-dropdown sp-overlay"
    }
  });
} );

var getData = function() {
  var url = $('#previewUrl').val();
  var creative = $("#creativeId").val();
  var testParam = $(".aspect-button.sp-state-active").attr('data-test');
  var aspect = $(".aspect-button.sp-state-active").attr('data-aspect');

  return {
    url: url,
    creative: creative,
    testParam: testParam,
    aspect: aspect
  } 
}

var getUrl = function() {
  var data = getData();
  var url = data.url + '?kw=' + data.testParam + '&creative=' + data.creative + '&aspect=' + data.aspect;
  return url;
}

var setIframe = function(url) {
  $('#iframe').attr('src', url);
  var data = getData();
  history.replaceState({}, "", "?url=" + data.url + '&creative=' + data.creative + "&aspect=" + data.aspect);
}

var urlParams = function() {
  var params = window.location.search;
  params = params.split('&');
  var obj = {}
  for ( var i = 0; i < params.length; i++) { 
    params[i] = params[i].replace('?', '');
    params[i] = params[i].split('=');
    var param = params[i];
    if (param[0] == 'url' || param[0] == 'creative' || param[0] == 'aspect') {
      obj[param[0]] = param[1];
    }
  }
  return obj
}

var init = function() {
  var params = urlParams();

  if (params.url) {
    $('.url-button').removeClass('sp-state-active');
    $('#previewUrl').val(params.url);
  }

  if (params.creative) {
    $('.creative-button').removeClass('sp-state-active');
    $('#creativeId').val(params.creative);
  }

  if (params.aspect) {
    $('.aspect-button').removeClass('sp-state-active');
    $('[data-aspect="' + params.aspect + '"]').addClass('sp-state-active');
    var data = getData();
    if (data.aspect == '2by1') {
      $('#browser').addClass('mobile-view');
    } else {
      $('#browser').removeClass('mobile-view');
    }
  }

  setIframe(getUrl());
}

init();


$('.url-button').click(function() {
  $('.url-button').removeClass('sp-state-active');
  var url = $(this).attr('data-url');
  $(this).addClass('sp-state-active');
  $('#previewUrl').val(url);
  setIframe(getUrl());
});

$('.creative-button').click(function() {
  $('.creative-button').removeClass('sp-state-active');
  var creative = $(this).attr('data-creative');
  $(this).addClass('sp-state-active');
  $('#creativeId').val(creative);
  setIframe(getUrl());
});

$('.aspect-button').click(function() {
  $('.aspect-button').removeClass('sp-state-active');
  $(this).addClass('sp-state-active');
  var data = getData();
  if (data.aspect == '2by1') {
    $('#browser').addClass('mobile-view');
  } else {
    $('#browser').removeClass('mobile-view');
  }
  setIframe(getUrl());
});

$("#reload").click(function() {
  var data = getData();
  if (data.aspect == '2by1') {
    $('#browser').addClass('mobile-view');
  } else {
    $('#browser').removeClass('mobile-view');
  }
  setIframe(getUrl());
});

$("#newWindow").click(function() {
  window.open(getUrl(), 'newWindow');
  return false;
});

</script>
</body>
</html>